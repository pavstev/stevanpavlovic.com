---
import type { HTMLAttributes } from "astro/types";
import { cva, type VariantProps } from "class-variance-authority";
import { cn } from "../../lib/cn";

const avatarVariants = cva("relative flex shrink-0 overflow-hidden rounded-full transition-all duration-300", {
  defaultVariants: {
    size: "md",
    variant: "default",
  },
  variants: {
    size: {
      lg: "size-12",
      md: "size-10",
      sm: "size-8",
      xl: "size-16",
      xs: "size-6",
    },
    variant: {
      default: "border border-border/50 bg-muted/20",
      glass: "glass border-white/10 bg-white/5",
      primary: "shadow-glow-primary border border-primary/30 bg-primary/10",
    },
  },
});

export interface Props extends HTMLAttributes<"div">, VariantProps<typeof avatarVariants> {
  fallback?: string;
  src?: string;
}

const { class: className, fallback, size, src, variant, ...props } = Astro.props;
---

<div class={cn(avatarVariants({ size, variant }), className)} {...props}>
  {
    src ? (
      <img alt={fallback || "Avatar"} class="aspect-square size-full object-cover" src={src} />
    ) : (
      <div class="flex size-full items-center justify-center bg-muted font-medium text-muted-foreground uppercase">
        <span
          class={cn(
            "select-none",
            size === "xs" && "text-[10px]",
            size === "sm" && "text-xs",
            size === "md" && "text-sm",
            size === "lg" && "text-base",
            size === "xl" && "text-xl",
          )}
        >
          {fallback || "?"}
        </span>
      </div>
    )
  }
</div>
