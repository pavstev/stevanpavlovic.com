---
import type { HTMLAttributes } from "astro/types";

import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "../../lib/cn";
import { buildResponsiveClasses, type ResponsiveValue } from "../../lib/styles";

const stackVariants = cva("flex");

export interface Props extends HTMLAttributes<"div">, VariantProps<typeof stackVariants> {
  align?: ResponsiveValue<"baseline" | "center" | "end" | "start" | "stretch">;
  as?: any;
  direction?: ResponsiveValue<"col" | "col-reverse" | "row" | "row-reverse">;
  gap?: ResponsiveValue<number | string>;
  justify?: ResponsiveValue<"around" | "between" | "center" | "end" | "evenly" | "start">;
  wrap?: ResponsiveValue<"nowrap" | "wrap" | "wrap-reverse">;
}

const { align, as: Tag = "div", class: className, direction = "col", gap = 3, justify, wrap, ...rest } = Astro.props;

const directionClass = buildResponsiveClasses(direction, "flex");
const gapClass = buildResponsiveClasses(gap, "gap");
const alignClass = buildResponsiveClasses(align, "items");
const justifyClass = buildResponsiveClasses(justify, "justify");

// Handle wrap classes with proper tailwind class names
const wrapClass = wrap
  ? typeof wrap === "object"
    ? [
      `flex-wrap-${wrap.base}`,
      wrap.sm ? `sm:flex-wrap-${wrap.sm}` : "",
      wrap.md ? `md:flex-wrap-${wrap.md}` : "",
      wrap.lg ? `lg:flex-wrap-${wrap.lg}` : "",
      wrap.xl ? `xl:flex-wrap-${wrap.xl}` : "",
    ]
      .join(" ")
      .replace(/flex-wrap-nowrap/g, "flex-nowrap")
      .replace(/flex-wrap-wrap-reverse/g, "flex-wrap-reverse")
      .trim()
    : `flex-wrap-${wrap}`
      .replace(/flex-wrap-nowrap/g, "flex-nowrap")
      .replace(/flex-wrap-wrap-reverse/g, "flex-wrap-reverse")
  : "";
---

<Tag
  class:list={[cn(stackVariants(), directionClass, alignClass, justifyClass, gapClass, wrapClass, className)]}
  {...rest}
>
  <slot />
</Tag>
