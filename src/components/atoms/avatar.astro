---
import type { ImageMetadata } from 'astro';

import { Image } from 'astro:assets';
import { cva, type VariantProps } from 'class-variance-authority';

import { cn } from '../../lib/cn';

/**
 * Avatar Component - Clean, minimalistic design
 * With consistent sizing and optional ring
 */
const avatarVariants = cva(
  // Base styles
  'relative overflow-hidden rounded-full bg-muted',
  // Flex centering for initial state
  'flex items-center justify-center',
  {
    defaultVariants: {
      ring: false,
      size: 'md',
    },
    variants: {
      ring: {
        false: '',
        true: 'ring-2 ring-ring ring-offset-2 ring-offset-background',
      },
      size: {
        // Giant - Landing pages
        '2xl': 'size-32',
        // Large - Profile cards
        lg: 'size-16',
        // Medium - Default avatar size
        md: 'size-10',
        // Small - For tags, badges
        sm: 'size-8',
        // Extra large - Hero sections
        xl: 'size-24',
        // Extra small
        xs: 'size-6',
      },
    },
  }
);

interface Props extends VariantProps<typeof avatarVariants> {
  alt: string;
  class?: string;
  fetchpriority?: 'auto' | 'high' | 'low';
  loading?: 'eager' | 'lazy';
  src: ImageMetadata | string;
}

const {
  alt,
  class: className,
  fetchpriority,
  loading,
  ring,
  size,
  src,
} = Astro.props;

// Calculate image dimensions based on size
const sizeMap: Record<string, number> = {
  '2xl': 128,
  lg: 64,
  md: 40,
  sm: 32,
  xl: 96,
  xs: 24,
};

const imageSize = sizeMap[size] || 40;
---

<div class:list={cn(avatarVariants({ className, ring, size }))}>
  <Image
    alt={alt}
    class="size-full object-cover"
    fetchpriority={fetchpriority}
    height={imageSize}
    loading={loading}
    src={src as any}
    width={imageSize}
  />
</div>
