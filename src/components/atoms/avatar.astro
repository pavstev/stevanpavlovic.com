---
import type { ImageMetadata } from 'astro';
import { Image } from 'astro:assets';
import { cva, type VariantProps } from 'class-variance-authority';
import { cn } from '../../lib/cn';

const avatarVariants = cva(
  'relative overflow-hidden rounded-full bg-muted flex items-center justify-center',
  {
    defaultVariants: {
      ring: false,
      size: 'md',
    },
    variants: {
      ring: {
        false: '',
        true: 'ring-2 ring-ring ring-offset-2 ring-offset-background',
      },
      size: {
        '2xl': 'size-32',
        lg: 'size-16',
        md: 'size-10',
        sm: 'size-8',
        xl: 'size-24',
        xs: 'size-6',
      },
    },
  }
);

interface Props extends VariantProps<typeof avatarVariants> {
  alt: string;
  class?: string;
  fetchpriority?: 'auto' | 'high' | 'low';
  loading?: 'eager' | 'lazy';
  src: ImageMetadata | string;
}

const {
  alt,
  class: className,
  fetchpriority,
  loading,
  ring,
  size,
  src,
} = Astro.props;

const sizeMap: Record<string, number> = {
  '2xl': 128,
  lg: 64,
  md: 40,
  sm: 32,
  xl: 96,
  xs: 24,
};

const imageSize = (size && typeof size === 'string' && sizeMap[size]) || 40;
---

<div class={cn(avatarVariants({ className, ring, size }))}>
  <Image
    alt={alt}
    class="size-full object-cover"
    fetchpriority={fetchpriority}
    height={imageSize}
    loading={loading}
    src={src as any}
    width={imageSize}
  />
</div>
