---
import type { ImageMetadata } from 'astro';

import { Image } from 'astro:assets';
import { cva, type VariantProps } from 'class-variance-authority';

import { cn } from '../../lib/cn';

const avatarVariants = cva(
  'overflow-hidden rounded-full border border-border bg-muted',
  {
    defaultVariants: {
      size: 'md',
    },
    variants: {
      size: {
        lg: 'size-16',
        md: 'size-10',
        sm: 'size-8',
        xl: 'size-24',
      },
    },
  }
);

interface Props extends VariantProps<typeof avatarVariants> {
  alt: string;
  as?: string;
  class?: string;
  fetchpriority?: "auto" | "high" | "low";
  loading?: "eager" | "lazy";
  src: ImageMetadata | string;
}

const {
  alt,
  as: Tag = 'div',
  class: className,
  fetchpriority,
  loading,
  size,
  src,
} = Astro.props;

const imageSize = typeof size === 'string' && size === 'xl' ? 96 : 40;
---

<Tag class:list={cn(avatarVariants({ className, size }))}>
  <Image
    alt={alt}
    class="size-full object-cover"
    fetchpriority={fetchpriority}
    height={imageSize}
    loading={loading}
    src={src as any}
    width={imageSize}
  />
</Tag>
