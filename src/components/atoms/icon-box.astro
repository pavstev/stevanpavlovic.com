---
import type { HTMLAttributes } from 'astro/types';

import { cva, type VariantProps } from 'class-variance-authority';

import { cn } from '../../lib/cn';

/**
 * IconBox Component - Minimalistic icon containers
 * Following Vercel/Geist design principles
 */
const iconBoxVariants = cva(
  // Base styles
  'flex items-center justify-center rounded-lg transition-all duration-200 ease-out',
  // Focus states
  'focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background focus-visible:outline-none',
  {
    defaultVariants: {
      size: 'md',
      variant: 'default',
    },
    variants: {
      size: {
        // Large - Prominent icons
        lg: 'size-12',
        // Medium - Default
        md: 'size-10',
        // Small - For tight spaces
        sm: 'size-8',
        // Extra large - Hero icons
        xl: 'size-16',
      },
      variant: {
        // Accent - Blue tones
        accent:
          'border border-secondary/20 bg-secondary/10 text-secondary',
        // Default - Subtle background
        default:
          'border border-border/50 bg-muted/50 text-muted-foreground',
        // Filled - Solid background
        filled:
          'border border-primary/20 bg-primary/10 text-primary',
        // Ghost - Minimal, no background
        ghost:
          'text-muted-foreground hover:text-foreground',
        // Outline - Border only
        outline:
          'border border-border text-muted-foreground hover:text-foreground',
      }
    },
  }
);

interface Props extends HTMLAttributes<'div'>, Omit<VariantProps<typeof iconBoxVariants>, 'size'> {
  as?: 'div' | 'span';
  class?: string;
  size?: 'lg' | 'md' | 'sm' | 'xl' | number;
}

const {
  as: Tag = 'div',
  class: className,
  size = 'md',
  variant = 'default',
  ...props
} = Astro.props;

// Handle numeric sizes
const isNumericSize = typeof size === 'number';
const numericStyle = isNumericSize
  ? { '--size': `${size}px`, height: 'var(--size)', width: 'var(--size)' } as const
  : {};
---

<Tag
  class:list={cn(
    iconBoxVariants({ className, variant }),
    !isNumericSize && size
  )}
  style={isNumericSize ? numericStyle : undefined}
  {...props}
>
  <slot />
</Tag>
