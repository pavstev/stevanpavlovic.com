---
import AppIcon from "./app-icon.astro";
---

<button
  aria-label="Scroll to top"
  class="group fixed right-20 bottom-3 z-40 flex translate-y-20 cursor-pointer items-center gap-1.5 rounded-full bg-foreground/5 px-3 py-1.5 text-sm font-semibold text-muted-foreground opacity-0 shadow-lg backdrop-blur-sm transition-all duration-300 hover:bg-foreground/10 hover:text-foreground hover:shadow-xl"
  id="smart-scroll-to-top"
  type="button"
>
  TOP
  <AppIcon class="transition-transform duration-300 group-hover:-translate-y-0.5" name="mdi:arrow-up" size="sm" />
</button>

<script>
  const btn = document.getElementById("smart-scroll-to-top");

  function updateVisibility() {
    if (!btn) return;
    const currentScrollY = window.scrollY;
    const threshold = 200;

    if (currentScrollY > threshold) {
      btn.classList.remove("translate-y-20", "opacity-0");
      btn.classList.add("translate-y-0", "opacity-100");
    } else {
      btn.classList.remove("translate-y-0", "opacity-100");
      btn.classList.add("translate-y-20", "opacity-0");
    }
  }

  function scrollToTop() {
    window.scrollTo({ behavior: "smooth", top: 0 });
  }

  if (btn) {
    btn.addEventListener("click", scrollToTop);
    window.addEventListener("scroll", updateVisibility, { passive: true });
    // Initial check
    updateVisibility();
  }
</script>
