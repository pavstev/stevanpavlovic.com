---
import { NAV_ITEMS, NAV_ITEMS_ARRAY } from "../../config";
import { isActivePath } from "../../lib/nav";
import Button from "../atoms/Button.astro";
import Container from "../atoms/Container.astro";
import Logo from "../molecules/BrandLogo.astro";
import MobileMenuToggle from "../molecules/mobile-menu-toggle.astro";
import MobileMenu from "../molecules/MobileNav.astro";
import Search from "../organisms/search.astro";
import LayoutWrapper from "./layout-wrapper.astro";

const { pathname } = Astro.url;
const isActive = (href: string) => isActivePath(pathname, href);
---

<header class="fixed top-3 z-50 w-full px-4 transition-all duration-500 md:px-0" id="site-header" transition:persist>
  <Container>
    <LayoutWrapper class="items-center">
      {/* Main Bar */}
      <div
        class="glass-strong hover:shadow-glow-subtle relative flex h-14 w-full items-center rounded-full px-2 shadow-2xl transition-all duration-500 hover:border-foreground/20"
      >
        {/* Left: Logo */}
        <div class="shrink-0 pl-2">
          <Logo />
        </div>

        {/* Center: Search - Desktop */}
        <div class="hidden flex-1 justify-center md:flex">
          <Search variant="desktop" />
        </div>

        {/* Right: Nav & Mobile Toggle */}
        <div class="flex items-center gap-2 pr-2">
          {/* Mobile Search (Visible only on mobile) */}
          <div class="md:hidden">
            <Search variant="mobile" />
          </div>
          {/* Desktop Nav */}
          <nav class="hidden items-center gap-1 md:flex" id="desktop-nav">
            {
              NAV_ITEMS_ARRAY.map((item) => {
                const active = isActive(item.href);
                return (
                  <Button
                    aria-current={active ? "page" : undefined}
                    class:list={[
                      "relative rounded-full px-4 py-2 text-sm font-semibold transition-all duration-300",
                      {
                        "bg-primary/10 text-primary ring-1 ring-primary/20 hover:bg-primary/20 hover:shadow-[0_0_15px_rgba(59,130,246,0.2)]":
                          active,
                        "text-muted-foreground hover:bg-foreground/5 hover:text-foreground": !active,
                      },
                    ]}
                    data-nav-link
                    href={item.href}
                  >
                    <span>{item.label}</span>
                    {active && (
                      <div class="absolute -bottom-1 left-1/2 h-0.5 w-3 -translate-x-1/2 rounded-full bg-primary shadow-[0_0_10px_var(--color-primary)]" />
                    )}
                  </Button>
                );
              })
            }
          </nav>

          {/* Socials Removed (Moved to Footer) */}

          {/* Mobile Toggle */}
          <MobileMenuToggle size="sm" />
        </div>
      </div>
    </LayoutWrapper>
  </Container>
</header>

<MobileMenu navItems={Object.values(NAV_ITEMS)} />

<script>
  import { initMobileMenu, updateActiveLinks } from "../../lib/mobile-menu";

  const init = () => {
    initMobileMenu();
    updateActiveLinks();
  };

  init();
  document.addEventListener("astro:page-load", init);
  document.addEventListener("astro:after-swap", updateActiveLinks);
</script>
