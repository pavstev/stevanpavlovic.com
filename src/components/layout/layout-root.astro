---
import type { HTMLAttributes } from "astro/types";

import { cn } from "@client/utils";

import "../../styles/global.css";
import "@fontsource-variable/space-grotesk";
import "@fontsource-variable/inter";
import "@fontsource-variable/jetbrains-mono";
import { ClientRouter } from "astro:transitions";

import Header from "./header.astro";
import { MainLayout } from "./main-layout";

interface Props extends HTMLAttributes<"html"> {
  description: string;
  image?: URL;
  intensity?: "high" | "low" | "medium";
  isFullWidth?: boolean;
  lang?: string;
  slug?: string;
  title: string;
}

const { class: className, description, lang = "en", title, ...rest } = Astro.props;
---

<!doctype html>
<html class="scroll-smooth" lang={lang} {...rest}>
  <head>
    <meta content="nosniff" http-equiv="X-Content-Type-Options" />
    <meta content="DENY" http-equiv="X-Frame-Options" />
    <meta content="camera=(), microphone=(), geolocation=()" http-equiv="Permissions-Policy" />
    <meta content={description} name="description" />
    <title>{title}</title>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect" />
    <!-- Analytics removed placeholder -->
    <ClientRouter />
    <script is:inline>
      const getTheme = () => {
        const localStorageTheme =
          typeof localStorage !== "undefined" ? localStorage.getItem("theme") : null;
        if (localStorageTheme && ["dark", "light"].includes(localStorageTheme)) {
          return localStorageTheme;
        }
        if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
          return "dark";
        }
        return "light";
      };

      const setDarkClass = () => {
        const theme = getTheme();
        if (theme === "dark") {
          document.documentElement.classList.add("dark");
        } else {
          document.documentElement.classList.remove("dark");
        }
      };

      setDarkClass();
      document.addEventListener("astro:after-swap", setDarkClass);
    </script>
    <slot name="head" />
  </head>
  <body
    class={cn(
      "bg-background",
      "text-foreground",
      "antialiased",
      "selection:bg-primary/20",
      "selection:text-foreground",
      className
    )}
  >
    <MainLayout client:load>
      <Header slot="header" />
      <slot />
    </MainLayout>
  </body>
</html>
