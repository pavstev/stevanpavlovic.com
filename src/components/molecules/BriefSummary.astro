---
import { cn } from "../../lib/cn";
import Icon from "../atoms/Icon.astro";
import PropertyField from "./PropertyField.astro";

interface Props {
  class?: string;
  label?: string;
  text?: string;
}

const { class: className, label = "Description", text } = Astro.props;
---

{
  text && (
    <div class:list={["min-w-0", className]}>
      <PropertyField label={label}>
        <div class="relative w-full">
          <details class="group/details text-sm font-medium text-muted-foreground">
            <summary class="cursor-pointer list-none transition-colors hover:text-primary [&::-webkit-details-marker]:hidden">
              <div class="line-clamp-4 leading-relaxed tracking-tight text-foreground/70 transition-all duration-300 group-open/details:line-clamp-none">
                {text}
              </div>
              <div class="toggle-buttons mt-3 hidden">
                <div class="group-open/details:hidden">
                  <div class="inline-flex items-center gap-2 border border-primary/20 bg-primary/5 px-2 py-0.5 text-[10px] font-bold tracking-widest text-primary uppercase transition-all duration-300 hover:bg-primary/10 hover:shadow-[0_0_15px_var(--color-primary)]">
                    <span class="size-1 animate-pulse-neon rounded-full bg-primary shadow-[0_0_8px_var(--color-primary)]" />
                    Expand
                    <Icon name="mdi:chevron-down" size="sm" />
                  </div>
                </div>
                <div class="hidden group-open/details:block">
                  <div class="inline-flex items-center gap-2 border border-foreground/10 bg-foreground/5 px-2 py-0.5 text-[10px] font-bold tracking-widest text-foreground/50 uppercase transition-all duration-300 hover:border-primary/20 hover:text-primary">
                    Collapse
                    <Icon name="mdi:chevron-up" size="sm" />
                  </div>
                </div>
              </div>
            </summary>
          </details>
        </div>
      </PropertyField>
    </div>
  )
}

<script>
  import { setupDescriptionToggles } from "../../lib/post-description";

  document.addEventListener("astro:page-load", setupDescriptionToggles);
  setupDescriptionToggles();
  window.addEventListener("resize", setupDescriptionToggles);
  setTimeout(setupDescriptionToggles, 100);
</script>
