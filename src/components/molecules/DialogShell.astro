---
import { cn } from "../../lib/cn";
import Icon from "../atoms/Icon.astro";

interface Props {
  caption?: string;
  class?: string;
  contentClass?: string;
  id: string;
  showCloseButton?: boolean;
  variant?: "card" | "plain";
}

const { caption, class: className, contentClass, id, showCloseButton = true, variant = "card" } = Astro.props;
---

<dialog
  class:list={cn(
    "fixed inset-0 z-50 m-auto hidden overflow-hidden bg-transparent p-0 open:flex open:size-full open:items-center open:justify-center focus:outline-none",
    variant === "card" && "open:size-fit",
    "backdrop:bg-black/60 backdrop:backdrop-blur-xl backdrop:transition-opacity backdrop:duration-300",
    variant === "card" && "open:animate-in open:fade-in open:zoom-in-95 open:duration-200",
    variant === "plain" && "open:animate-in open:fade-in open:duration-300",
    className,
  )}
  id={id}
>
  <div
    class:list={cn(
      "relative flex flex-col items-center justify-center",
      variant === "card" && [
        "w-full max-w-lg overflow-hidden rounded-2xl border border-foreground/5 bg-card shadow-2xl backdrop-blur-sm",
        "before:absolute before:-inset-1 before:-z-10 before:rounded-2xl before:bg-linear-to-br before:from-primary/20 before:via-accent/10 before:to-secondary/20 before:opacity-5 before:blur-3xl",
      ],
      contentClass,
    )}
  >
    {variant === "card" && <div class="absolute inset-0 rounded-2xl bg-card/50 backdrop-blur-sm" />}

    <div class:list={cn("relative z-10 w-full", variant === "card" && "p-5")}>
      {
        showCloseButton && (
          <button
            aria-label="Close"
            class:list={cn(
              "close-modal-btn absolute z-50 cursor-pointer rounded-full p-2 transition-all duration-300 hover:scale-105 active:scale-95",
              variant === "card"
                ? "top-3 right-3 text-muted-foreground hover:bg-foreground/10 hover:text-foreground hover:shadow-lg focus:ring-2 focus:ring-foreground/20 focus:outline-none"
                : "fixed top-5 right-5 flex size-11 items-center justify-center border border-white/10 bg-background/20 text-white shadow-2xl backdrop-blur-xl hover:border-white/20 hover:bg-background/40",
            )}
            type="button"
          >
            <Icon name="mdi:close" size={variant === "card" ? "lg" : "xl"} />
          </button>
        )
      }

      <slot />

      {
        caption && variant === "card" && (
          <div class="mt-3 border-t border-foreground/10 pt-3">
            <div class="text-sm leading-relaxed text-muted-foreground">{caption}</div>
          </div>
        )
      }
    </div>
  </div>
</dialog>

<script>
  import { initModals } from "../../lib/modal";
  initModals();
  document.addEventListener("astro:page-load", initModals);
</script>
