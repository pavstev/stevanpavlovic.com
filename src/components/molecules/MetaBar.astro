---
import { type Tag, type ToolbarItem as ToolbarItemType, type ViewPagePropsTags } from "../../lib";
import Icon from "../atoms/Icon.astro";
import Stack from "../atoms/Stack.astro";
import BrandLogo from "./BrandLogo.astro";
import BriefSummary from "./BriefSummary.astro";
import LabelGroup from "./LabelGroup.astro";
import PropertyField from "./PropertyField.astro";

interface Props {
  description?: string;
  tags?: ViewPagePropsTags;
  toolbarItems?: (ToolbarItemType | undefined)[];
}

const {
  description,
  tags = {
    items: [] as Tag[],
    title: undefined,
  },
  toolbarItems = [],
} = Astro.props;

const items = toolbarItems.filter((i): i is ToolbarItemType => !!i);
---

<div
  class="group/toolbar grid w-full grid-cols-1 gap-3 rounded-2xl border border-border/40 bg-background/40 p-3 backdrop-blur-md md:grid-cols-8"
>
  {/* Column 1: Description */}
  <div class="min-w-0 md:col-span-3">
    <BriefSummary text={description} />
  </div>

  {/* Column 2 & 3: Metadata */}
  <div class="flex min-w-0 flex-col gap-4 md:col-span-2 md:border-x md:border-border/40 md:px-6">
    {
      items.map((item) => (
        <PropertyField class="min-w-0" label={item.label}>
          {item.type === "status" ? (
            <Stack align="center" direction="row" gap={2}>
              <BrandLogo size="sm" variant="status" />
              <span class="text-sm font-semibold text-foreground">{item.value}</span>
            </Stack>
          ) : (
            <Stack align="center" direction="row" gap={2}>
              {item.logo && (
                <BrandLogo
                  alt={item.value}
                  size="sm"
                  src={item.logo}
                  variant={item.type === "person" ? "person" : "organization"}
                />
              )}

              {item.href ? (
                <a
                  class="group/link flex items-center gap-1.5 text-sm font-semibold text-muted-foreground transition-colors group-hover/toolbar:text-foreground hover:text-primary"
                  href={item.href}
                  target="_blank"
                >
                  <span class="truncate">{item.value}</span>
                  <Icon
                    class="size-3 transition-transform duration-300 group-hover/link:translate-x-0.5 group-hover/link:-translate-y-0.5"
                    name="mdi:arrow-top-right"
                  />
                </a>
              ) : (
                <span class="text-sm font-semibold text-foreground">{item.value}</span>
              )}
            </Stack>
          )}
        </PropertyField>
      ))
    }
  </div>

  {/* Column 4: Tags */}
  <div class="min-w-0 md:col-span-3">
    <LabelGroup items={tags.items} title={tags.title} />
  </div>
</div>
