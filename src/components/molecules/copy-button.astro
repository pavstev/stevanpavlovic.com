---
import Button from "../atoms/button.astro";

/**
 * Feature #21: Shiki Code Copy Buttons
 * Optimized to use the project's custom AppButton and Icon.
 */

// We render these templates once so the script can clone them.
// They are hidden from the accessibility tree and visual layout.
---

<div aria-hidden="true" class="hidden" id="copy-button-template">
  <Button
    class="copy-code-button absolute top-3 right-3 z-10 scale-90 opacity-0 transition-all duration-300 group-hover:scale-100 group-hover:opacity-100 focus:scale-100 focus:opacity-100"
    icon="mdi:content-copy"
    size="sm"
    variant="glass"
  />
</div>

<div aria-hidden="true" class="hidden" id="copy-success-template">
  <Button
    class="border-green-500/30 bg-green-500/10 text-green-400 shadow-[0_0_15px_rgba(74,222,128,0.2)]"
    icon="mdi:check"
    size="sm"
    variant="glass"
  />
</div>

<script>
  import { initCopyButtons } from "../../lib/copy-button";
  initCopyButtons();
  document.addEventListener("astro:after-swap", initCopyButtons);
</script>

<style is:global>
  /* Ensure Shiki pre tags don't clip the button or the glow */
  pre {
    overflow: visible !important;
  }

  /* Target the code container specifically for internal scrolling */
  pre > code {
    display: block;
    overflow-x: auto;
    padding-top: 1rem;
  }

  .copy-code-button {
    backdrop-filter: blur(8px);
  }
</style>
