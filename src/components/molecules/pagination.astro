---
import { Icon } from 'astro-icon/components';

import Button from '../atoms/button.astro';
import Dropdown from '../atoms/dropdown.astro';
import Stack from '../atoms/stack.astro';
import Text from '../atoms/text.astro';

interface Props {
  baseUrl: string;
  currentPage: number;
  itemsPerPage?: number;
  totalItems?: number;
  totalPages: number;
}

const { baseUrl, currentPage, itemsPerPage = 9, totalItems, totalPages } = Astro.props;

function getPageUrl(page: number): string {
  const url = new URL(baseUrl, 'http://localhost');
  if (page === 1) {
    url.searchParams.delete('page');
  } else {
    url.searchParams.set('page', String(page));
  }
  return url.pathname + url.search;
}

// Items per page options
const itemsPerPageOptions = [
  { href: getPageUrlWithLimit(6), label: '6', value: '6' },
  { href: getPageUrlWithLimit(9), label: '9', value: '9' },
  { href: getPageUrlWithLimit(12), label: '12', value: '12' },
  { href: getPageUrlWithLimit(24), label: '24', value: '24' },
];

function getItemsPerPageHref(count: number): string {
  return getPageUrlWithLimit(count);
}

function getPageUrlWithLimit(limit: number): string {
  const url = new URL(baseUrl, 'http://localhost');
  url.searchParams.set('limit', String(limit));
  return url.pathname + url.search;
}
---

<nav aria-label="Pagination" class="w-full">
  <Stack align="center" class="w-full" direction="row" gap={3} justify="between" wrap="wrap">
    {/* Left: Total items */}
    {totalItems !== undefined && (
      <Text class="text-sm text-muted-foreground" size="sm">
        {totalItems.toLocaleString()} total
      </Text>
    )}

    {/* Right: Pagination controls */}
    <Stack align="center" direction="row" gap={2}>
      {/* Items per page dropdown */}
      {itemsPerPage && (
        <Dropdown
          align="right"
          id="items-per-page-nav"
          label={`${itemsPerPage}`}
          options={itemsPerPageOptions.map((opt) => ({
            ...opt,
            href: getItemsPerPageHref(Number(opt.value)),
          }))}
          selectedValue={String(itemsPerPage)}
          size="sm"
          variant="outline"
        />
      )}

      {/* Page navigation */}
      <div class="flex items-center gap-1 rounded-lg bg-muted/50 p-0.5">
        <Button
          as="a"
          class="size-7 rounded-md p-0 sm:size-8"
          disabled={currentPage === 1}
          href={currentPage > 1 ? getPageUrl(currentPage - 1) : undefined}
          size="icon"
          variant="ghost"
        >
          <Icon class="size-3.5 sm:size-4" name="mdi:chevron-left" />
          <span class="sr-only">Previous page</span>
        </Button>

        <div class="flex items-center px-2">
          <span class="text-xs font-medium tabular-nums sm:text-sm">
            {currentPage}
          </span>
          <span class="mx-1 text-xs text-muted-foreground sm:text-sm">/</span>
          <span class="text-xs text-muted-foreground tabular-nums sm:text-sm">
            {totalPages}
          </span>
        </div>

        <Button
          as="a"
          class="size-7 rounded-md p-0 sm:size-8"
          disabled={currentPage === totalPages}
          href={currentPage < totalPages ? getPageUrl(currentPage + 1) : undefined}
          size="icon"
          variant="ghost"
        >
          <Icon class="size-3.5 sm:size-4" name="mdi:chevron-right" />
          <span class="sr-only">Next page</span>
        </Button>
      </div>
    </Stack>
  </Stack>
</nav>
