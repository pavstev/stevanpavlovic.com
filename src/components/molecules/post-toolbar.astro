---
import { type Tag, type ToolbarItem as ToolbarItemType, type ViewPagePropsTags } from "../../lib";
import AppIcon from "../atoms/app-icon.astro";
import ToolbarItem from "../atoms/toolbar-item.astro";
import ToolbarLogo from "../atoms/toolbar-logo.astro";
import PostDescription from "./post-description.astro";
import PostTags from "./post-tags.astro";

interface Props {
  description?: string;
  tags: undefined | ViewPagePropsTags;
  toolbarItems: (ToolbarItemType | undefined)[];
}

const {
  description,
  tags = {
    items: [] as Tag[],
    title: undefined,
  },
  toolbarItems = [],
} = Astro.props;

const items = toolbarItems.filter((i): i is ToolbarItemType => !!i);
---

<div
  class="group/toolbar grid w-full grid-cols-1 gap-4 rounded-2xl border border-border/40 bg-background/40 p-4 backdrop-blur-md md:grid-cols-8"
>
  {/* Column 1: Description (Wider) */}
  <div class="min-w-0 md:col-span-3">
    <PostDescription description={description} />
  </div>

  {/* Column 2 & 3: Metadata (Author, Published, etc.) */}
  <div class="flex min-w-0 flex-col gap-6 md:col-span-2 md:border-x md:border-border/40 md:px-8">
    {
      items.map((item) => (
        <ToolbarItem className="min-w-0" label={item.label}>
          {item.type === "status" ? (
            <div class="flex items-center gap-2">
              <ToolbarLogo size="sm" type="status" />
              <span class="text-sm font-semibold text-foreground">{item.value}</span>
            </div>
          ) : (
            <div class="flex items-center gap-2.5">
              {item.logo && (
                <ToolbarLogo
                  alt={item.value}
                  size="sm"
                  src={item.logo}
                  type={item.type === "person" ? "person" : "organization"}
                />
              )}

              {item.href ? (
                <a
                  class="group/link flex items-center gap-1.5 text-sm font-semibold text-muted-foreground transition-colors group-hover/toolbar:text-foreground hover:text-primary"
                  href={item.href}
                  target="_blank"
                >
                  <span class="truncate">{item.value}</span>
                  <AppIcon
                    class="size-3 transition-transform duration-300 group-hover/link:translate-x-0.5 group-hover/link:-translate-y-0.5"
                    name="mdi:arrow-top-right"
                  />
                </a>
              ) : (
                <span class="text-sm font-semibold text-foreground">{item.value}</span>
              )}
            </div>
          )}
        </ToolbarItem>
      ))
    }
  </div>

  {/* Column 4: Tags */}
  <div class="min-w-0 md:col-span-3">
    <PostTags tags={tags.items} title={tags.title} />
  </div>
</div>
