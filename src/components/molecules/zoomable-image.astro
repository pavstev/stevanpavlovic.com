---
import type { ImageMetadata } from 'astro';

import { Icon } from 'astro-icon/components';
import { Image } from 'astro:assets';

import Button from '../atoms/button.astro';
import Modal from '../atoms/modal.astro';

interface Props {
  alt: string;
  class?: string;
  height?: number;
  loading?: "eager" | "lazy";
  src: ImageMetadata | string;
  width?: number;
}

const { alt, class: className, height, loading = "lazy", src, width } = Astro.props;

// Unique ID for this instance's modal
const modalId = `zoom-modal-${Math.random().toString(36).substring(2, 11)}`;
const imageSrc = typeof src === 'string' ? src : src.src;
---

<Button
  aria-label={`Zoom image: ${alt}`}
  class:list={["group relative block h-auto w-full cursor-zoom-in overflow-hidden border-none bg-transparent p-0", className]}
  onclick={`document.getElementById('${modalId}').showModal()`}
  variant="ghost"
>
  {typeof src === 'string' ? (
    <img
      alt={alt}
      class="size-full object-cover transition-transform duration-500 group-hover:scale-105"
      loading={loading}
      src={src}
    />
  ) : (
    <Image
      alt={alt}
      class="size-full object-cover transition-transform duration-500 group-hover:scale-105"
      height={height}
      loading={loading}
      src={src}
      width={width}
    />
  )}

  {/* Hover hint */}
  <div class="absolute inset-0 flex items-center justify-center bg-black/0 opacity-0 transition-colors duration-300 group-hover:bg-black/10 group-hover:opacity-100">
    <div class="rounded-md bg-black/50 p-3 text-foreground backdrop-blur-sm">
      <Icon name="mdi:magnify-plus-outline" size={24} />
    </div>
  </div>
</Button>

<Modal class="h-screen max-h-none! w-screen max-w-none! border-none bg-transparent p-4 backdrop:bg-black/90 sm:p-6" id={modalId}>
  <div class="flex size-full items-center justify-center">
    <img
      alt={alt}
      class="max-h-[90vh] max-w-full object-contain"
      src={imageSrc}
    />
  </div>
</Modal>
