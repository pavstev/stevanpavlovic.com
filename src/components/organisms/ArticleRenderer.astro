---
import { cn } from "../../lib/cn";
import Container from "../atoms/Container.astro";
import Stack from "../atoms/Stack.astro";

export interface Props {
  as?: any;
  class?: string;
  showSidebar?: boolean;
}

const { as: Tag = "article", class: className } = Astro.props;
const hasSidebar = Astro.slots.has("sidebar");
const hasToc = Astro.slots.has("toc");
---

<Container as={Tag} class:list={[cn("relative z-10", className)]}>
  <Stack gap={12}>
    {/* Named Slot: Header (Hero, Meta) */}
    {
      Astro.slots.has("header") && (
        <header class="w-full">
          <slot name="header" />
        </header>
      )
    }

    {/* Primary Layout Engine (12-Col) */}
    <div class:list={["grid gap-12", hasSidebar || hasToc ? "lg:grid-cols-12" : "max-w-4xl mx-auto w-full"]}>
      {/* Position: Left Sidebar (TOC) */}
      {
        hasToc && (
          <aside class="hidden lg:block lg:col-span-3">
            <div class="sticky top-24">
              <slot name="toc" />
            </div>
          </aside>
        )
      }

      {/* Position: Main Content (8, 9, or 12 Cols) */}
      <div
        class:list={[
          cn(
            "min-w-0 transition-all",
            hasSidebar && hasToc ? "lg:col-span-6" : hasSidebar || hasToc ? "lg:col-span-9" : "w-full",
          ),
        ]}
      >
        <slot />

        {/* Named Slot: Footer (Related, Navigation) */}
        {
          Astro.slots.has("footer") && (
            <footer class="mt-20 pt-10 border-t border-white/5">
              <slot name="footer" />
            </footer>
          )
        }
      </div>

      {/* Position: Right Sidebar */}
      {
        hasSidebar && (
          <aside class:list={["lg:col-span-3", !hasToc && "lg:col-start-10"]}>
            <div class="sticky top-24">
              <slot name="sidebar" />
            </div>
          </aside>
        )
      }
    </div>
  </Stack>
</Container>
