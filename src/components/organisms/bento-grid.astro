---
// BentoGrid.astro
// A smart, responsive bento grid layout with Shadcn-like theming and Astro optimization.

interface Props {
  className?: string;
}

const { className } = Astro.props;
---

<!-- Load Icons (Phosphor) -->
<script src="https://unpkg.com/@phosphor-icons/web"></script>

<div class:list={["mx-auto w-full max-w-[1200px] p-4 sm:p-6", className]}>
  <!-- Grid Layout -->
  <div class="grid-auto-rows-[minmax(180px,auto)] grid grid-cols-1 gap-4 md:grid-cols-3 lg:grid-cols-4">
    <!-- 1. Hero / Bio Card (Large) -->
    <div
      class="group relative col-span-1 row-span-2 overflow-hidden rounded-(--radius) border border-[hsl(var(--border))] bg-[hsl(var(--card))] p-8 transition-all hover:shadow-lg md:col-span-2 lg:col-span-2"
    >
      <!-- Background Gradient/Grain -->
      <div
        class="pointer-events-none absolute inset-0 bg-[radial-gradient(#e5e7eb_1px,transparent_1px)] bg-size-[16px_16px] opacity-20 dark:bg-[radial-gradient(#27272a_1px,transparent_1px)]"
      >
      </div>

      <div class="relative z-10 flex h-full flex-col justify-between">
        <div class="flex items-start justify-between">
          <div class="relative">
            <div
              class="inline-flex items-center gap-2 rounded-full border border-[hsl(var(--border))] bg-[hsl(var(--secondary))] px-3 py-1 text-xs font-medium text-[hsl(var(--secondary-foreground))]"
              id="status-badge"
            >
              <span class="relative flex size-2">
                <span class="absolute inline-flex size-full animate-ping rounded-full bg-green-400 opacity-75"></span>
                <span class="relative inline-flex size-2 rounded-full bg-green-500"></span>
              </span>
              <span id="status-text">Available for work</span>
            </div>
          </div>
          <button
            class="rounded-full bg-[hsl(var(--secondary))] p-2 text-[hsl(var(--foreground))] transition-colors hover:bg-[hsl(var(--muted))]"
            id="theme-toggle"
          >
            <i class="ph-fill ph-moon text-xl dark:hidden"></i>
            <i class="ph-fill ph-sun hidden text-xl dark:block"></i>
          </button>
        </div>

        <div>
          <h1 class="mb-4 text-4xl font-bold tracking-tight text-[hsl(var(--foreground))] sm:text-5xl">
            Hello, I'm <span class="bg-gradient-to-r from-blue-500 to-indigo-500 bg-clip-text text-transparent"
              >Alex</span
            >.
          </h1>
          <p class="max-w-md text-lg text-[hsl(var(--muted-foreground))]">
            A detail-oriented <span class="font-medium text-[hsl(var(--foreground))]">Full Stack Engineer</span> crafting
            robust web applications with modern architecture.
          </p>
        </div>

        <div class="flex gap-3">
          <button
            class="inline-flex items-center justify-center rounded-md bg-[hsl(var(--primary))] px-6 py-2.5 text-sm font-medium text-[hsl(var(--primary-foreground))] shadow-sm transition-colors hover:bg-[hsl(var(--primary))]/90 focus-visible:ring-1 focus-visible:ring-[hsl(var(--ring))] focus-visible:outline-none"
          >
            Download CV
          </button>
          <button
            class="inline-flex items-center justify-center rounded-md border border-[hsl(var(--input))] bg-transparent px-6 py-2.5 text-sm font-medium shadow-sm transition-colors hover:bg-[hsl(var(--accent))] hover:text-[hsl(var(--accent-foreground))]"
          >
            Copy Email
          </button>
        </div>
      </div>
    </div>

    <!-- 2. Location & Time (Smart Widget) -->
    <div
      class="group relative col-span-1 row-span-1 overflow-hidden rounded-(--radius) border border-[hsl(var(--border))] bg-[hsl(var(--card))]"
    >
      <!-- Interactive Map Background (Placeholder) -->
      <div class="absolute inset-0 transition-transform duration-700 group-hover:scale-110">
        <img
          alt="Location Map"
          class="size-full object-cover opacity-80 grayscale transition-all group-hover:grayscale-0 dark:opacity-50"
          onerror="this.src='https://images.unsplash.com/photo-1496442226666-8d4a0e62e6e9?auto=format&fit=crop&q=80&w=500'"
          src="https://api.mapbox.com/styles/v1/mapbox/dark-v10/static/-74.006,40.7128,12,0/400x400?access_token=YOUR_TOKEN"
        />
      </div>
      <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"></div>

      <div class="relative z-10 flex h-full flex-col justify-between p-6">
        <div
          class="self-end rounded-lg border border-white/10 bg-black/40 px-2 py-1 text-xs text-white backdrop-blur-md"
        >
          UTC-5
        </div>
        <div>
          <div class="mb-1 flex items-center gap-2 text-white">
            <i class="ph-fill ph-map-pin text-indigo-400"></i>
            <span class="font-medium">New York, USA</span>
          </div>
          <time class="text-3xl font-bold tracking-tighter text-white tabular-nums" id="clock"> 00:00:00 </time>
        </div>
      </div>
    </div>

    <!-- 3. Tech Stack (Marquee) -->
    <div
      class="col-span-1 row-span-1 flex flex-col justify-between overflow-hidden rounded-(--radius) border border-[hsl(var(--border))] bg-[hsl(var(--card))] p-6 transition-colors hover:border-[hsl(var(--ring))]"
    >
      <div class="flex items-center gap-2 text-[hsl(var(--foreground))]">
        <i class="ph-duotone ph-stack text-xl"></i>
        <h3 class="font-semibold">Toolbox</h3>
      </div>

      <div class="mt-4 grid grid-cols-4 gap-4">
        <!-- Replaced with semantic HTML/CSS icons for portability -->
        <div
          class="group flex aspect-square items-center justify-center rounded-md bg-[hsl(var(--secondary))] text-2xl transition-colors hover:bg-orange-100 hover:text-orange-600 dark:hover:bg-orange-900/20"
          title="Astro"
        >
          <i class="ph-fill ph-rocket-launch"></i>
        </div>
        <div
          class="group flex aspect-square items-center justify-center rounded-md bg-[hsl(var(--secondary))] text-2xl transition-colors hover:bg-blue-100 hover:text-blue-600 dark:hover:bg-blue-900/20"
          title="React"
        >
          <i class="ph-fill ph-atom"></i>
        </div>
        <div
          class="group flex aspect-square items-center justify-center rounded-md bg-[hsl(var(--secondary))] text-2xl transition-colors hover:bg-cyan-100 hover:text-cyan-600 dark:hover:bg-cyan-900/20"
          title="Tailwind"
        >
          <i class="ph-fill ph-paint-brush"></i>
        </div>
        <div
          class="group flex aspect-square items-center justify-center rounded-md bg-[hsl(var(--secondary))] text-2xl transition-colors hover:bg-yellow-100 hover:text-yellow-600 dark:hover:bg-yellow-900/20"
          title="JS"
        >
          <i class="ph-fill ph-code"></i>
        </div>
        <div
          class="group flex aspect-square items-center justify-center rounded-md bg-[hsl(var(--secondary))] text-2xl transition-colors hover:bg-green-100 hover:text-green-600 dark:hover:bg-green-900/20"
          title="Node"
        >
          <i class="ph-fill ph-hard-drives"></i>
        </div>
        <div
          class="group flex aspect-square items-center justify-center rounded-md bg-[hsl(var(--secondary))] text-2xl transition-colors hover:bg-purple-100 hover:text-purple-600 dark:hover:bg-purple-900/20"
          title="Figma"
        >
          <i class="ph-fill ph-figma-logo"></i>
        </div>
        <div
          class="group flex aspect-square items-center justify-center rounded-md bg-[hsl(var(--secondary))] text-2xl transition-colors hover:bg-white hover:text-black dark:hover:bg-white dark:hover:text-black"
          title="Next.js"
        >
          <i class="ph-fill ph-terminal"></i>
        </div>
        <div
          class="group flex aspect-square items-center justify-center rounded-md bg-[hsl(var(--secondary))] text-2xl transition-colors hover:bg-red-100 hover:text-red-600 dark:hover:bg-red-900/20"
          title="Git"
        >
          <i class="ph-fill ph-git-branch"></i>
        </div>
      </div>
    </div>

    <!-- 4. Spotify / Activity (Tall) -->
    <div
      class="relative col-span-1 row-span-2 overflow-hidden rounded-(--radius) bg-zinc-900 p-6 text-white shadow-xl md:col-span-1"
    >
      <!-- Animated visualizer background -->
      <div class="absolute right-0 bottom-0 left-0 h-32 bg-gradient-to-t from-green-500/20 to-transparent"></div>

      <div class="relative z-10 flex h-full flex-col">
        <div class="mb-6 flex items-center justify-between">
          <i class="ph-fill ph-spotify-logo text-3xl text-[#1DB954]"></i>
          <div class="flex h-3 items-end gap-1">
            <span class="w-1 animate-[music-bar_1s_ease-in-out_infinite] bg-[#1DB954]"></span>
            <span class="w-1 animate-[music-bar_1.2s_ease-in-out_infinite_0.1s] bg-[#1DB954]"></span>
            <span class="w-1 animate-[music-bar_0.8s_ease-in-out_infinite_0.2s] bg-[#1DB954]"></span>
          </div>
        </div>

        <!-- Album Art with Spin -->
        <div class="relative mx-auto mb-6 size-32">
          <div class="absolute inset-0 rounded-full bg-white/10 blur-md"></div>
          <img
            alt="Album Art"
            class="size-full animate-[spin_8s_linear_infinite] rounded-full border-2 border-white/10 object-cover shadow-2xl"
            src="https://images.unsplash.com/photo-1493225255756-d9584f8606e9?auto=format&fit=crop&q=80&w=400"
          />
          <div class="absolute inset-0 flex items-center justify-center">
            <div class="size-4 rounded-full border border-white/20 bg-zinc-900"></div>
          </div>
        </div>

        <div class="mt-auto space-y-2 text-center">
          <h3 class="truncate text-lg font-bold">Synthesizer</h3>
          <p class="text-sm text-white/60">Electric Youth</p>

          <div class="mt-4 h-1 w-full overflow-hidden rounded-full bg-white/10">
            <div class="h-full w-[60%] rounded-full bg-[#1DB954]"></div>
          </div>

          <div class="mt-4 flex items-center justify-center gap-4 pt-2">
            <button class="text-white/60 hover:text-white"><i class="ph-fill ph-skip-back text-xl"></i></button>
            <button
              class="flex size-10 items-center justify-center rounded-full bg-white text-black transition-transform hover:scale-105"
              ><i class="ph-fill ph-pause text-xl"></i></button
            >
            <button class="text-white/60 hover:text-white"><i class="ph-fill ph-skip-forward text-xl"></i></button>
          </div>
        </div>
      </div>
    </div>

    <!-- 5. Projects Link -->
    <a
      class="group relative col-span-1 row-span-1 flex flex-col justify-between overflow-hidden rounded-(--radius) border border-[hsl(var(--border))] bg-[hsl(var(--card))] p-6 transition-all hover:bg-[hsl(var(--accent))]"
      href="/projects"
    >
      <div class="flex items-start justify-between">
        <div class="rounded-full bg-[hsl(var(--secondary))] p-2.5">
          <i class="ph-duotone ph-folder-notch-open text-xl text-[hsl(var(--foreground))]"></i>
        </div>
        <i
          class="ph-bold ph-arrow-up-right text-[hsl(var(--muted-foreground))] transition-transform group-hover:translate-x-1 group-hover:-translate-y-1"
        ></i>
      </div>
      <div>
        <h3 class="font-bold text-[hsl(var(--foreground))]">Projects</h3>
        <p class="text-sm text-[hsl(var(--muted-foreground))]">4 shipped, 2 in progress</p>
      </div>
    </a>

    <!-- 6. Connect / Socials -->
    <div
      class="col-span-1 row-span-1 flex flex-col justify-center gap-3 rounded-(--radius) border border-[hsl(var(--border))] bg-[hsl(var(--card))] p-6"
    >
      <a
        class="flex items-center gap-3 rounded-lg border border-transparent p-2 transition-colors hover:bg-[hsl(var(--secondary))]"
        href="/todo"
      >
        <i class="ph-fill ph-github-logo text-xl text-[hsl(var(--foreground))]"></i>
        <span class="text-sm font-medium text-[hsl(var(--foreground))]">GitHub</span>
        <i class="ph-bold ph-arrow-right ml-auto text-xs text-[hsl(var(--muted-foreground))]"></i>
      </a>
      <a
        class="flex items-center gap-3 rounded-lg border border-transparent p-2 transition-colors hover:bg-[hsl(var(--secondary))]"
        href="/todo"
      >
        <i class="ph-fill ph-twitter-logo text-xl text-sky-500"></i>
        <span class="text-sm font-medium text-[hsl(var(--foreground))]">Twitter</span>
        <i class="ph-bold ph-arrow-right ml-auto text-xs text-[hsl(var(--muted-foreground))]"></i>
      </a>
    </div>

    <!-- 7. Newsletter (Wide) -->
    <div
      class="col-span-1 flex flex-col items-center justify-between gap-6 rounded-(--radius) border border-[hsl(var(--border))] bg-[hsl(var(--primary))] p-8 text-[hsl(var(--primary-foreground))] shadow-lg md:col-span-2 md:flex-row lg:col-span-2"
    >
      <div class="space-y-2">
        <h3 class="text-2xl font-bold">Stay updated</h3>
        <p class="max-w-sm text-[hsl(var(--primary-foreground))]/80">
          Get notified when I ship new projects or write about engineering.
        </p>
      </div>
      <div class="flex w-full max-w-sm items-center space-x-2">
        <input
          class="flex h-10 w-full rounded-md border border-[hsl(var(--input))] bg-[hsl(var(--background))] px-3 py-2 text-sm text-[hsl(var(--foreground))] ring-offset-[hsl(var(--background))] file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-[hsl(var(--muted-foreground))] focus-visible:ring-2 focus-visible:ring-[hsl(var(--ring))] focus-visible:ring-offset-2 focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50"
          placeholder="Email address"
          type="email"
        />
        <button
          class="inline-flex h-10 items-center justify-center rounded-md bg-[hsl(var(--secondary))] px-4 py-2 font-medium text-[hsl(var(--secondary-foreground))] transition-colors hover:bg-[hsl(var(--secondary))]/80"
        >
          Subscribe
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  // --- Logic for Interactivity ---

  // 1. Clock Logic
  function updateTime() {
    const clock = document.getElementById("clock");
    if (clock) {
      const now = new Date();
      // Use Intl.DateTimeFormat for better control over time formatting
      clock.textContent = new Intl.DateTimeFormat("en-US", {
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
        hour12: false,
      }).format(now);
    }
  }
  setInterval(updateTime, 1000);
  updateTime();

  // 2. Theme Toggle Logic (Shadcn Compatible)
  const toggleBtn = document.getElementById("theme-toggle");
  const htmlEl = document.documentElement;

  // Check system preference on load
  if (
    localStorage.getItem("theme") === "dark" ||
    (!("theme" in localStorage) && window.matchMedia("(prefers-color-scheme: dark)").matches)
  ) {
    htmlEl.classList.add("dark");
  }

  toggleBtn?.addEventListener("click", () => {
    if (htmlEl.classList.contains("dark")) {
      htmlEl.classList.remove("dark");
      localStorage.setItem("theme", "light");
    } else {
      htmlEl.classList.add("dark");
      localStorage.setItem("theme", "dark");
    }
  });

  // 3. Status Badge Logic (Smart availability based on time)
  function updateStatus() {
    const statusText = document.getElementById("status-text");
    const statusBadge = document.getElementById("status-badge");
    const now = new Date();
    const hour = now.getHours();

    // Assume "Work Hours" are 9AM to 6PM
    const isWorkingHours = hour >= 9 && hour < 18;

    if (statusText && statusBadge) {
      if (isWorkingHours) {
        statusText.textContent = "Available for work";
        statusBadge.className =
          "inline-flex items-center gap-2 rounded-full border border-[hsl(var(--border))] bg-green-100 dark:bg-green-900/30 px-3 py-1 text-xs font-medium text-green-700 dark:text-green-400";
      } else {
        statusText.textContent = "Deep Focus / Offline";
        statusBadge.className =
          "inline-flex items-center gap-2 rounded-full border border-[hsl(var(--border))] bg-[hsl(var(--secondary))] px-3 py-1 text-xs font-medium text-[hsl(var(--muted-foreground))]";
      }
    }
  }
  updateStatus();
</script>

<style>
  /* Tailwind v4+ CSS Native Variable Usage
      If you are using Tailwind v4, these just work.
      If v3, they work because we mapped standard utility classes above.
    */
  @keyframes music-bar {
    0%,
    100% {
      height: 20%;
    }
    50% {
      height: 80%;
    }
  }

  .animate-music-bar {
    animation: music-bar 1s ease-in-out infinite;
  }
</style>
