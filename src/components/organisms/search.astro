---
import SearchInput from "../molecules/search-input.astro";

interface Props {
  variant?: "desktop" | "mobile";
}

const { variant = "desktop" } = Astro.props;
const id = variant === "mobile" ? "mobile-search" : "desktop-search";
---

<div class="search-dropdown-container relative" data-search-variant={variant} id={`${id}-container`}>
  <SearchInput class="md:w-48 lg:w-64" id={`${id}-input`} placeholder="Search..." type="text" />

  {/* Dropdown Menu */}
  <div
    aria-label="Search results"
    class="search-dropdown invisible absolute top-[calc(100%+0.5rem)] right-0 left-0 z-50 mx-auto w-[calc(100vw-2rem)] max-w-md opacity-0 transition-all duration-200 md:left-auto md:w-full lg:w-md"
    id={`${id}-dropdown`}
    role="menu"
  >
    <div class="overflow-hidden rounded-2xl border border-foreground/10 bg-background/95 shadow-2xl backdrop-blur-xl">
      {/* Search Results Area */}
      <div class="p-1.5">
        <div class="max-h-[60vh] overflow-y-auto" id={`${id}-results`}>
          {/* Results will be injected here */}
        </div>
      </div>

      {/* Keyboard Shortcuts Footer */}
      <div
        class="flex flex-wrap items-center gap-2 border-t border-foreground/5 bg-foreground/5 px-3 py-1.5 text-xs font-medium text-muted-foreground md:text-[10px]"
      >
        <span class="flex items-center gap-1">
          <kbd class="rounded-lg bg-foreground/10 px-1.5 py-0.5 font-sans text-[10px]">ESC</kbd>
          close
        </span>
        <span class="flex items-center gap-1">
          <kbd class="rounded-lg bg-foreground/10 px-1.5 py-0.5 font-sans text-[10px]">↑↓</kbd>
          navigate
        </span>
        <span class="flex items-center gap-1">
          <kbd class="rounded-lg bg-foreground/10 px-1.5 py-0.5 font-sans text-[10px]">↵</kbd>
          select
        </span>
      </div>
    </div>
  </div>
</div>

<script>
  import { initSearchDropdown } from "../../lib/search";

  document.addEventListener("astro:page-load", () => {
    initSearchDropdown();
  });
</script>

<style is:global>
  /* Search dropdown visible state */
  .search-dropdown.visible {
    visibility: visible;
    opacity: 1;
  }

  /* Show clear button when input has value */
  .search-clear.visible {
    display: flex !important;
  }
</style>
