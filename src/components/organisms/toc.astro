---
import Text from "../atoms/text.astro";

interface Props {
  headings: { depth: number; slug: string; text: string }[];
}

const { headings } = Astro.props;

const filteredHeadings = headings.filter((h) => h.depth > 1 && h.depth < 4);
---

<nav class="toc-container sticky top-8 hidden w-full max-w-[240px] lg:block">
  <Text class="mb-3 font-bold tracking-wider uppercase" size="xs" variant="muted"> On This Page </Text>

  <div class="js-toc relative">
    <ul class="space-y-1.5 border-l border-border text-sm">
      {
        filteredHeadings.map((heading) => (
          <li class:list={["relative", { "pl-4": heading.depth === 3 }]}>
            <Text
              as="a"
              class="toc-link -ml-[2px] block border-l-2 border-transparent py-0.5 pl-4 leading-tight transition-colors hover:text-foreground"
              href={`#${heading.slug}`}
              size="sm"
              variant="muted"
            >
              {heading.text}
            </Text>
          </li>
        ))
      }
    </ul>
  </div>
</nav>

<script>
  import { setupTOC } from "../../lib/toc";

  // Lifecycle listeners for Astro (including View Transitions)
  setupTOC();
  document.addEventListener("astro:after-swap", setupTOC);
</script>
