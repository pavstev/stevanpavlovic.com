---
import type {  ViewMode } from '../../lib/list';

import Stack from '../atoms/stack.astro';
import LayoutRoot from '../layout/layout-root.astro';
import ListActions from '../molecules/list-actions.astro';
import MasonryGrid from '../molecules/masonry-grid.astro';
import Card from '../organisms/card.astro';
import SectionHeader from "../organisms/section-header.astro";
import Section from "../organisms/section.astro";

interface Props {
  baseUrl: string;
  // Script configuration
  containerId: string;
  currentPage?: number;
  description: string;

  // Helpers to map generic items to Card props
  // eslint-disable-next-line no-unused-vars
  getItemCardProps: (item: any) => any;
  headerDescription: string;

  headerIcon: string;
  headerTitle: string;
  initialPageSize?: number;
  // Data
  items: any[]; // The collection items
  nextUrl?: string;
  prevUrl?: string;
  title: string;
  totalItems: number;

  totalPages?: number;

  // Configuration
  viewMode: ViewMode;
  viewUrls?: { grid: string; list: string; };
}

const {
  baseUrl,
  containerId,
  currentPage = 1,
  description,
  getItemCardProps,
  headerDescription,
  headerIcon,
  headerTitle,
  initialPageSize = 6,
  items,
  nextUrl,
  prevUrl,
  title,
  totalPages = 1,
  viewMode,
  viewUrls,
} = Astro.props;

// Determine if we should show List or Grid
const isList = viewMode === 'list';
const isGrid = viewMode === 'grid';
---

<LayoutRoot description={description} title={title}>
  <Section>
    <SectionHeader
      description={headerDescription}
      icon={headerIcon}
      title={headerTitle}
    >
      <ListActions
        baseUrl={baseUrl}
        currentPage={currentPage}
        getPageUrl={(p: number) => p === 1 ? `${baseUrl}/${viewMode}` : `${baseUrl}/${viewMode}/${p}`}
        nextUrl={nextUrl}
        paginationType="path"
        prevUrl={prevUrl}
        slot="action"
        totalPages={totalPages}
        viewMode={viewMode}
        viewUrls={viewUrls}
      />
    </SectionHeader>


    <Stack gap={4}>

      <div class="view-container" data-initial-page-size={initialPageSize} id={containerId}>

        {/* VIEW MODE: LIST */}
        {isList && (
          <div class="list-view flex flex-col gap-3 transition-opacity duration-300 sm:gap-4">
            {items.map((item) => (
              <div
                class="card-item transition-all duration-300"
              >
                <Card list {...getItemCardProps(item)} />
              </div>
            ))}
          </div>
        )}

        {/* VIEW MODE: GRID */}
        {isGrid && (
          <div class="grid-view transition-opacity duration-300">
            <MasonryGrid columns={2}>
              {items.map((item) => (
                <div
                  class="masonry-item card-item transition-all duration-300"
                >
                  <Card {...getItemCardProps(item)} />
                </div>
              ))}
            </MasonryGrid>
          </div>
        )}

        {/* No Results */}
        <div class="mt-12 hidden text-center text-muted-foreground" id="no-results">
          <div class="flex flex-col items-center justify-center gap-2">
            <span class="text-4xl">üîç</span>
            <p class="text-lg font-medium">No results found.</p>
            <a class="mt-4 rounded-full bg-secondary/10 px-4 py-2 text-sm font-semibold text-secondary transition-colors hover:bg-secondary/20" href={baseUrl}>
                Clear Filters
            </a>
          </div>
        </div>

      </div>
    </Stack>
  </Section>
</LayoutRoot>



<script>
  import { initInteractiveCards } from '../../lib/interactive-cards';

  const setup = () => {
    initInteractiveCards();
  };

  setup();
  document.addEventListener('astro:page-load', setup);
</script>
