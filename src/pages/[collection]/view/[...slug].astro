---
import { type CollectionEntry, getCollection, render } from 'astro:content';
import type {Params} from './../index.astro';
import { getViewPageProps } from "../../lib/collection-pages";

import PostView from '../../../components/organisms/post-view.astro';
import SectionHeader from '../../../components/organisms/section-header.astro';

export const prerender = true;

export const getStaticPaths = async () => {
  const {collection} = Astro.params as unknown as Params;
  const items = await getCollection(collection);
  return items.map((item) => ({
    params: { slug: item.id },
    props: item,
  }));
};

const {collection} = Astro.params as unknown as Params;
const entry = Astro.props;
const { Content } = await render(entry);

import { getViewPageProps } from "../../lib/collection-pages";

const { title, subtitle, description, icon, tags, date } = getViewPageProps({
  collection: collection as "blog" | "experience" | "projects",
  data: entry.data,
  id: entry.id,
});
---

<SectionHeader
  backText={`Back to ${collection.charAt(0).toUpperCase() + collection.slice(1)}`}
  backUrl={`/${collection}`}
  description={getDescription()}
  icon={getIcon()}
  subtitle={getSubtitle()}
  tags={getTags()}
  title={getTitle()}
>
  <div slot="action">
    <span class="text-muted">{getDate()}</span>
  </div>
</SectionHeader>

<PostView collection={collection} data={entry.data}>
  <Content />
</PostView>
