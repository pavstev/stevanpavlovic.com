# yaml-language-server: $schema=./../../../eslint/schemas/tasks.schema.json
vars:
  # Directories
  root_dir: .
  golib_dir: tools/golib
  golib_bin: tools/golib/dist/gocli

  # Base Commands
  pnpm_exec: pnpm exec
  go_cmd: go

tasks:
  lint_eslint:
    name: ESLint
    command: ${pnpm_exec} eslint .
    cwd: ${root_dir}
  lint_go:
    name: Go linter
    command: golangci-lint run --fix ./...
    cwd: ${golib_dir}
  check_astro:
    name: Astro Check
    command: ${pnpm_exec} astro check
    cwd: ${root_dir}
  check_go:
    name: Go Vet
    command: ${go_cmd} vet ./...
    cwd: ${golib_dir}
  build_astro:
    name: Astro Build
    command: ${pnpm_exec} astro build
    cwd: ${root_dir}
  build_go:
    name: Go Build
    command: ${go_cmd} build -o ../../${golib_bin} ./main.go
    cwd: ${golib_dir}
  test_vitest:
    name: Vitest
    command: ${pnpm_exec} vitest run
    cwd: ${root_dir}
  test_go:
    name: Go Tests
    command: ${go_cmd} test ./... -coverprofile=coverage.out -v
    cwd: ${golib_dir}

  prettier_write:
    name: Prettier
    command: ${pnpm_exec} prettier -w --cache .
    cwd: ${root_dir}

  # Standalone task definition.
  # Note: The 'setup' logic now calls the internal Go function
  # directly instead of using this task to avoid recursion.
  optimize_svg:
    name: Optimize SVG
    command: ${golib_bin} optimize-svg src/assets/**/*.svg
    cwd: ${root_dir}

  # Setup
  setup_install_uv:
    name: Install uv
    command: curl -LsSf https://astral.sh/uv/install.sh | sh
    cwd: ${root_dir}
  setup_install_pnpm:
    name: Install pnpm
    command: npm install -g pnpm
    cwd: ${root_dir}
  setup_uv_sync:
    name: uv sync
    command: uv sync
    cwd: ${root_dir}
  setup_wrangler_types:
    name: Wrangler Types
    command: ${pnpm_exec} wrangler types
    cwd: ${root_dir}
  resume_export:
    name: Export Resume
    command: ${pnpm_exec} resumed export -t jsonresume-theme-even -o resume.pdf resume.json
    cwd: ${root_dir}
